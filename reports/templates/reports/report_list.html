<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ—¥å ±ã‚¢ãƒ—ãƒª</title>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>ã¿ã‚“ãªã®æ—¥å ±ä¸€è¦§</h1>
        
        <div style="background: #f0f0f0; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <form method="get" style="display: flex; gap: 10px; align-items: center;">
                
                <input type="text" name="query" value="{{ request.GET.query }}" 
                    placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢..." 
                    style="padding: 5px; width: 200px;">
                
                <select name="category" style="padding: 5px;">
                    <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>

                <button type="submit" style="background: #333; color: white; border: none; padding: 6px 15px; cursor: pointer;">
                    æ¤œç´¢
                </button>
                
                <a href="{% url 'report_list' %}" style="font-size: 0.9em; margin-left: 10px;">ã‚¯ãƒªã‚¢</a>
            </form>
        </div>

        <div>
            {% if user.is_authenticated %}
                <span style="margin-right: 10px;">
                    ã‚ˆã†ã“ãã€<strong>{{ user.username }}</strong> ã•ã‚“
                </span>
                
                <form action="{% url 'logout' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" style="background: gray; color: white; border: none; padding: 5px 10px; cursor: pointer;">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </form>
            {% else %}
                <a href="{% url 'login' %}" style="background: blue; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px;">
                    ãƒ­ã‚°ã‚¤ãƒ³
                </a>
            {% endif %}
        </div>

        <div style="margin-bottom: 10px;">
            <a href="{% url 'report_ranking' %}" style="text-decoration: none; font-weight: bold;">
                ğŸ“Š ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»é›†è¨ˆã‚’è¦‹ã‚‹
            </a>
        </div>
        <hr>
    </div>

    {% if user.is_authenticated %}
        <a href="{% url 'report_create' %}" style="display:inline-block; padding:10px; background:green; color:white; text-decoration:none;">
            ï¼‹ æ—¥å ±ã‚’æ›¸ã
        </a>
    {% endif %}
    <hr>

    {% for report in reports %}
        <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 10px;">
            <h2>
                <a href="{% url 'report_detail' report.pk %}">{{ report.title }}</a>
                
                {% if report.condition == 'bad' %}
                    <span style="color: red; font-size: 0.6em;">ã€SOSï¼ã€‘</span>
                {% elif report.condition == 'tired' %}
                    <span style="color: orange; font-size: 0.6em;">ã€ãŠç–²ã‚Œæ°—å‘³ã€‘</span>
                {% else %}
                    <span style="color: green; font-size: 0.6em;">ã€{{ report.get_condition_display }}ã€‘</span>
                {% endif %}
            </h2>

            <p>
                <strong>{{ report.author.username }}</strong> ã•ã‚“ 
                ({{ report.created_at|date:"Y/m/d H:i" }}) | 
                ã‚«ãƒ†ã‚´ãƒªãƒ¼: {{ report.category.name }}
            </p>

            <p>
                ã‚¿ã‚°: 
                {% for tag in report.tags.all %}
                    <span style="background: #eee; padding: 2px 5px;">#{{ tag.name }}</span>
                {% endfor %}
            </p>

            {% if report.image %}
                <div style="margin-top: 10px;">
                    <img src="{{ report.image.url }}" alt="æŠ•ç¨¿ç”»åƒ" 
                        style="max-width: 100%; max-height: 200px; object-fit: cover; border-radius: 5px;">
                </div>
            {% endif %}

            <p>{{ report.content|linebreaksbr }}</p>
        </div>
    {% empty %}
        <p>ã¾ã æ—¥å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
</body>
</html>