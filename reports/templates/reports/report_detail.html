<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ report.title }} - 詳細</title>
</head>
<body>
    <a href="{% url 'report_list' %}">← 一覧に戻る</a>
    <hr>

    <h1>{{ report.title }}</h1>
    <p>
        カテゴリー: {{ report.category.name }} | 
        現在のPV数: <strong>{{ report.view_count }}</strong> 回
    </p>

    <p>今日の調子: 
        {% if report.condition == 'bad' %}
            <span style="color: red; font-weight: bold;">SOS ({{ report.get_condition_display }})</span>
        {% else %}
            {{ report.get_condition_display }}
        {% endif %}
    </p>

    {% if report.image %}
        <div style="margin: 20px 0;">
            <img src="{{ report.image.url }}" alt="投稿画像" 
                style="max-width: 100%; max-height: 500px; object-fit: contain;">
        </div>
    {% endif %}

    <div style="border-top: 1px solid #ccc; padding-top: 20px; margin-top: 20px;">
        <p>{{ report.content|linebreaksbr }}</p>
    </div>

    <div style="margin-top: 20px;">
        タグ: 
        {% for tag in report.tags.all %}
            <span style="background: #eee; padding: 5px;">#{{ tag.name }}</span>
        {% endfor %}
    </div>

    <div style="margin-top: 20px;">
        <a href="{% url 'report_update' report.pk %}" 
        style="background: orange; color: white; padding: 5px 10px; text-decoration: none; margin-right: 10px;">
        編集する
        </a>

        <a href="{% url 'report_delete' report.pk %}" 
        style="background: red; color: white; padding: 5px 10px; text-decoration: none;">
        削除する
        </a>
    </div>

    <hr style="margin-top: 40px;">
    
    <div style="background-color: #f9f9f9; padding: 20px; border-radius: 8px;">
        <h3>コメント（{{ report.comments.count }}件）</h3>

        {% for comment in report.comments.all %}
            <div style="border-bottom: 1px solid #ddd; padding: 10px 0;">
                <strong>{{ comment.author.username }}</strong>
                <span style="font-size: 0.8em; color: #666;">({{ comment.created_at|date:"Y/m/d H:i" }})</span>
                <p style="margin-top: 5px;">{{ comment.text|linebreaksbr }}</p>
            </div>
        {% empty %}
            <p style="color: #666;">まだコメントはありません。一番乗りで声をかけましょう！</p>
        {% endfor %}

        <div style="margin-top: 30px;">
            <h4>コメントを書く</h4>
            <form method="post">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit" style="background: green; color: white; padding: 5px 15px;">送信</button>
            </form>
        </div>
    </div>

</body>
</html>